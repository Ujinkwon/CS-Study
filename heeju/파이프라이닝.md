### 파이프라이닝이란?

#### 예상 면접 질문

- 병렬처리의 기법인 파이프라인과 슈퍼스칼라의 특징 설명
- 파이프 라이닝을 쓰는 이유와 효율을 설명하시오

#### 개념 정리

병렬처리는 동시에 여러 개의 명령을 처리하여 작업의 효율성을 높이는 방식을 의미한다. 대표적인 병렬처리 기법에는 파이프라인 기법과 슈퍼스칼라 기법이 있다.

파이프라이닝 이란,

명령어를 순차적으로 실행하는 프로세서에 적용되는 기술로, 한 번에 하나의 명령어만 실행하는 것이 아니라 하나의 명령어가 실행되는 도중에 다른 명령어를 실행을 시작하는 식으로 동시에 여러 개의 명령어를 실행하는 기법이다.

이렇게 **동시에 여러 개의 명령어를 처리하므로써 처리량을 올리는 것**이 파이프라이닝의 핵심이다.

모든 단계는 원래의 동작 속도대로 일을 하면서 처리량을 늘리는 것이지 원래의 동작 속도를 단축시키는 것은 아니다.

- 면접 질문: 파이프라이닝 사용 이유 :star:

  -> 파이프 라이닝 구조는 한 번에 하나의 명령어 처리가 아니라 하나의 명령어가 실행 되는 도중에 다른 명령어도 실행하여 각 단계에 있는 자원들을 놀리지 않고 역할을 부여함으로써 동시에 여러 개의 명령어를 처리할 수 있게 합니다. 이것은 처리량을 늘리기 때문에 동일 시간에 더 많은 명령어를 처리할 수 있기 때문에 효율적이라고 할 수 있습니다.

### 파이프라인 기법

![img](https://velog.velcdn.com/images%2Fleesilverash%2Fpost%2Fa606c804-d26f-4a89-8410-02010914348b%2Fimage.png)

###### *사진 출처:[http://blog.skby.net/%ED%8C%8C%EC%9D%B4%ED%94%84%EB%9D%BC%EC%9D%B8-pipeline/](http://blog.skby.net/파이프라인-pipeline/)*

- 명령어을 겹처서 실행하는 방법으로 하나의 코어에 여러 개의 스레드를 실행하여 CPU의 사용을 극대화하는 방법이다.
- 기존의 방식에서는 하나의 명령어를 처리하기 위해 명령어 처리의 4단계를 모두 마치고 다음 명령어를 실행한다. 하지만 파이프라인 기법은 명령어 처리의 단계마다 독립적인 구성을 통해 각 단계가 쉬지 않고 명령어를 처리한다.





아래 그림을 통해서 알아보기

 

세탁소에서 다음과 같은 순서로 일을 한다고 가정해 보겠습니다.

과정 1: 빨래를 세탁기에 넣는다.

과정 2: 세탁기를 동작시킨다.

과정 3: 건조기를 동작시킨다.

과정 4: 빨래를 갠다.

 

순차적 처리



![img](https://blog.kakaocdn.net/dn/cBl2UE/btqCIDVzDoQ/UclfFMZ00qeqRGcRc4K93k/img.png)그림 (1)



세탁물 1,2,3에 대해서 동시에 처리 할 수 없으므로 모든 작업을 마치는데 클럭이 12가 필요하지만

파이프라이닝 유사한 기법을 적용하면 아래와 같이 처리가 가능하다.

![img](https://blog.kakaocdn.net/dn/bKpDPR/btqCLLLHTHF/dOtN0pnuELzqhKnvXnaHg1/img.png)그림 (2)

그림과 같이 세탁물을 동시에 처리가 가능하므로 총 클럭이 6개만 필요하다.

매 클럭마다 여러 명령어를 중복된 단계 없이 처리한다.

그림 (2)에서 처럼 각 처리부는 독립적으로 동작하므로 클럭 주기 4에서 과정 4, 과정 3, 과정 2, 과정 1을 실행할 수 있다. 즉, 최대 4개의 명령어를 동시에 실행할 수 있다.

 

명령어를 세분화 할수록 처리 속도 향상을 기대 할 수 있다. (하지만, 실행할 명령어가 하나밖에 없거나 실행할 명령어 수에 비해 지나치게 단계를 세분화하게 되면 효율성을 기대하기 힘들 것이다. 하지만 일반적으로 CPU는 한 개의 명령어가 아닌 수십 개의 명령어를 함께 실행하기 때문에 효과적인 기술이 되고 있다.)

 

**파이프라이닝을 이용하여 명령어들을 실행하는데 걸리는 전체 시간**

T = k + (N - 1)

 

k는 첫 번째 명령어를 실행하는 데 걸리는 주기고, 나머지 (N - 1)개의 명령어들은 각각 한주기씩만 소요된다.

ex) 4 + (4 - 1) = 7 

 

**파이프라이닝을 이용함으로써 얻을 수 있는 속도 향상(Sp)**

Sp = (k * N) / { k + (N - 1) }

 

ex) (4*4) / { 4 + (4 - 1) } = 2.2857 향상

#### 가장 효율인 파이프라인 조건

- 각 단계별 처리 시간이 일정 해야한다.
- 각 명령의 처리 단계는 균일 해야한다.

 

처리 시간이 일정하지도 않고 처리 단계가 균등하지 않아서 문제가 발생하는데 이를 해저드(Hazard)라고 한다.



#### 파이프라인 기법의 문제점

- **데이터 위험**: 데이터 의존성으로 인해 발생되는 문제. A데이터를 의존하는 2번째 명령어는 앞의 명령어가 끝날 때까지 기다린 후에 실행되어야 한다.
  \- 해결 방법: 파이프라인의 명령어 단계 지연
- **제어 위험**: if문 혹은 goto문 등으로 분기가 발생할 때 현재 동시에 진행중이던 명령어들이 필요가 없어지면서 생기는 문제
  \- 해결 방법: 분기 예측 혹은 지연 방법으로 해결
- **구조 위험**: 서로 다른 명령어가 같은 자원에 접근하면서 프로그램이 비정상적으로 작동하거나 종료되는 문제
  \- 해결 방법: 해결하기 까다로움

:book:추가 부분

### 슈퍼스칼라 기법

![img](https://velog.velcdn.com/images%2Fleesilverash%2Fpost%2Faed93885-bd3c-4ca2-9a4c-79b2dfbe0530%2Fimage.png)

###### *사진 출처:[http://blog.skby.net/%ED%8C%8C%EC%9D%B4%ED%94%84%EB%9D%BC%EC%9D%B8-pipeline/](http://blog.skby.net/파이프라인-pipeline/)*

- 파이프라인과 병렬 처리의 장점을 모은 것
- 여러 개의 파이프라인에서 명령들이 병렬로 처리되도록 한 아키텍처로 대기 상태를 거치지 않고 동시에 실행될 수 있어 처리속도가 빠르다.
- 파이프라인과 비슷하지만 한 클록마다 명령어 한 개가 실행되는 것이 아닌 여러 개를 처리한다는 점에서 차이가 있다.

