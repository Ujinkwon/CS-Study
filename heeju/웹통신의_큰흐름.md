## 웹 통신의 큰 흐름

- 면접 단골 질문!

*우리가 Chrome 을 실행시켜 주소창에 특정 URL 값을 입력시키면 어떤 일이 일어나는가?*

### 프로토콜

네트워크 통신을 위해서 미리 정해놓은 공통된 메뉴얼 / 규약

### 라우터

라우터(router 혹은 라우팅 기능을 갖는 공유기)는 **컴퓨터 네트워크 간에 데이터 패킷을 전송하는 네트워크 장치**

### TCP/IP

인터넷에서 컴퓨터들이 서로 정보를 주고받는데 쓰이는 프로토콜의 집합

4개의 계층 존재

Application layer : 특정 서비스를 제공하기위해 애플리케이션끼리 정보를 주고받을수있음 / HTTP SSH DNS

transport layer: 송신된 데이터 수신측 애플리케이션에 확실히 전달 TCP UDP RTP 

internet layer : 수신측까지 데이터를 전달하기 위해 사용하게 됨 IP APP ICMP RARP

network access layer : 네트워크에 직접 연결된 기기 간 전송을 할 수 있다.  Ethernet PPP, Token Ring

### DNS 프로토콜

도메인 정보로 IP 주소를 알아낼수있다. 

## IP 주소

컴퓨터 네트워크에서 장치들이 서로를 인식하고 통신을 하기 위해서 사용하는 특수한 번호
→ 현재 사용하는 IPv4는 128.0.0.1과 같은 32비트 수로 구성되어 있다.

## Domain Name

IP 주소를 문자로 표현한 주소
→ DNS : IP주소와 도메인 이름의 매핑 정보를 담는 데이터베이스

# 작동 방식

![img](https://velog.velcdn.com/images%2Fwoo0_hooo%2Fpost%2Fe119383c-61cc-46d5-a85d-b27b65ddee1e%2FUntitled.png)

1. 사용자가 브라우저에 **도메인 이름을 입력**한다.
2. **DNS서버**에서 사용자가 입력한 Domain name을 검색하고, **매핑되는 IP주소**를 찾는다. 사용자가 입력한 URL 정보와 함께 리턴한다.
3. IP주소는 HTTP 프로토콜을 이용해서 **HTTP 요청 메세지를 생성**한다.
4. 생성된 HTTP 요청 메세지는 TCP 프로토콜을 사용해서 인터넷을 거쳐 **해당 IP 주소의 컴퓨터(서버)로** 전송된다.
5. 서버는 클라이언트의 요청을 승인하고, 응답 메세지를 전송한다.
6. 도착한 HTTP 응답 메세지는 HTTP 프로토콜을 사용하여 **웹페이지 데이터로 변환**되고, 웹 브라우저의 출력에 의해 사용자가 볼 수 있다.

# DNS 서버의 주소 찾기

## DHCP

- Dynamic Host COnfiguration Protocol

![img](https://velog.velcdn.com/images%2Fwoo0_hooo%2Fpost%2Fd5ff8273-2fa3-42ee-9158-e51139d93c53%2F2.png)

- 호스트의 IP 주소와 TCP/IP 설정을 클라이언트에 의해 자동으로 제공하는 응용 계층 프로토콜

  → 사용자는 DHCP 서버에서 자신의 IP 주소, 가장 가까운 라우터의 IP 주소, 가장 가까운 **DNS 서버의 주소**를 받는다.

## ARP

- Address Resolution Protocol
- 네트워크상에서 IP 주소를 물리적 네트워크 주소로 바인딩시키기 위해 사용하는 프로토콜
- DHCP로 얻은 라우터의 IP 주소를 MAC 주소로 변환

# DNS 서버에서 IP 정보 수신

![img](https://velog.velcdn.com/images%2Fwoo0_hooo%2Fpost%2F5ae6f285-3edd-4ed3-8bdf-7fdaaed19e2f%2F3.png)

1. DNS 서버에 DNS Query(www.example.com)를 전송한다

   : 우리나라의 경우에는 통신사별로 지정된 DNS 서버가 있다.

2. DNS 서버는 **루트 네임 서버**에 DNS Query를 질의한다.

   : 루트 네임 서버는 **.com의 ip주소**를 반환한다.

3. .com 네임 서버에 DNS 쿼리를 질의한다.

   : .com 네임 서버는 **example.com의 ip주소**를 반환한다.

4. [example.com](http://example.com/) 네임 서버에 DNS 쿼리를 질의한다.

   : www.example.com의 IP 주소를 반환한다.

DNS 서버는 계층화 구조를 이루는데, 최상단 계층인 가장 뒷쪽(.com, .kr 등등)을 담당하는 DNS 서버는 **전세계에 13개 뿐**이다.



# 웹 서버 접속

위의 과정으로 접속하려는 서버의 IP 주소를 알아냈다.



![img](https://velog.velcdn.com/images%2Fwoo0_hooo%2Fpost%2F0bb2fa41-4abc-44bd-96ac-06d7a4babf3d%2F4.png)

1. HTTP Request를 위해 TCP socket을 개방하고 연결한다.
2. TCP 연결에 성공하면, HTTP Request가 TCP socket을 통해 보내진다.
3. 웹 페이지의 정보가 응답으로 돌아온다.



-----



### in 브라우저

1. url 에 입력된 값을 브라우저 내부에서 결정된 규칙에 따라 그 의미를 조사한다.
2. 조사된 의미에 따라 HTTP Request 메시지를 만든다.
3. 만들어진 메시지를 웹 서버로 전송한다.

이 때 만들어진 메시지 전송은 브라우저가 직접하는 것이 아니다. 브라우저는 메시지를 네트워크에 송출하는 기능이 없으므로 OS에 의뢰하여 메시지를 전달한다. 우리가 택배를 보낼 때 직접 보내는게 아니라, 이미 서비스가 이루어지고 있는 택배 시스템(택배 회사)을 이용하여 보내는 것과 같은 이치이다. 단, OS에 송신을 의뢰할 때는 도메인명이 아니라 ip주소로 메시지를 받을 상대를 지정해야 하는데, 이 과정에서 DNS서버를 조회해야 한다.



### in 프로토콜 스택, LAN 어댑터

1. 프로토콜 스택(운영체제에 내장된 네트워크 제어용 소프트웨어)이 브라우저로부터 메시지를 받는다.
2. 브라우저로부터 받은 메시지를 패킷 속에 저장한다.
3. 그리고 수신처 주소 등의 제어정보를 덧붙인다.
4. 그런 다음, 패킷을 LAN 어댑터에 넘긴다.
5. LAN 어댑터는 다음 Hop의 MAC주소를 붙인 프레임을 전기신호로 변환시킨다.
6. 신호를 LAN 케이블에 송출시킨다.

프로토콜 스택은 통신 중 오류가 발생했을 때, 이 제어 정보를 사용하여 고쳐 보내거나, 각종 상황을 조절하는 등 다양한 역할을 하게 된다. 네트워크 세계에서는 비서가 있어서 우리가 비서에게 물건만 건네주면, 받는 사람의 주소와 각종 유의사항을 써준다! 여기서는 프로토콜 스택이 비서의 역할을 한다고 볼 수 있다.



### in 허브, 스위치, 라우터

1. LAN 어댑터가 송신한 프레임은 스위칭 허브를 경유하여 인터넷 접속용 라우터에 도착한다.
2. 라우터는 패킷을 프로바이더(통신사)에게 전달한다.
3. 인터넷으로 들어가게 된다.



### in 액세스 회선, 프로바이더

1. 패킷은 인터넷의 입구에 있는 액세스 회선(통신 회선)에 의해 POP(Point Of Presence, 통신사용 라우터)까지 운반된다.
2. POP 를 거쳐 인터넷의 핵심부로 들어가게 된다.
3. 수 많은 고속 라우터들 사이로 패킷이 목적지를 향해 흘러가게 된다.



### in 방화벽, 캐시서버

1. 패킷은 인터넷 핵심부를 통과하여 웹 서버측의 LAN 에 도착한다.
2. 기다리고 있던 방화벽이 도착한 패킷을 검사한다.
3. 패킷이 웹 서버까지 가야하는지 가지 않아도 되는지를 판단하는 캐시서버가 존재한다.

굳이 서버까지 가지 않아도 되는 경우를 골라낸다. 액세스한 페이지의 데이터가 캐시서버에 있으면 웹 서버에 의뢰하지 않고 바로 그 값을 읽을 수 있다. 페이지의 데이터 중에 다시 이용할 수 있는 것이 있으면 캐시 서버에 저장된다.



### in 웹 서버

1. 패킷이 물리적인 웹 서버에 도착하면 웹 서버의 프로토콜 스택은 패킷을 추출하여 메시지를 복원하고 웹 서버 애플리케이션에 넘긴다.
2. 메시지를 받은 웹 서버 애플리케이션은 요청 메시지에 따른 데이터를 응답 메시지에 넣어 클라이언트로 회송한다.
3. 왔던 방식대로 응답 메시지가 클라이언트에게 전달된다.



#### Personal Recommendation

- 참고 영상: https://www.youtube.com/watch?v=BEK354TRgZ8  테코톡
- Socket programming (Multi-chatting program)